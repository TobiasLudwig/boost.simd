<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.13"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.0.1/jquery.smartmenus.js"></script>
        <title>Boost.SIMD: Frequently Asked Questions</title>
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
        <link rel="icon" href="numscale_icon.png">
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="ns.css" rel="stylesheet" type="text/css"/>
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="ns.js"></script>
        <script type="text/javascript" src="custom.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header responsive-logo"/>
                    <a class="navbar-brand" href="http://developer.numscale.com/">
                        <span>Boost.SIMD</span>
                    </a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li id="version">
                            <a href="#" class="disabled">4.17.6.0</a>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a target="_blank" id="right-logo" href="http://www.numscale.com/" title="Numscale">
                                <img height=60 src="numscale.png" alt="Numscale">
                            </a>
                        </li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 35px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Frequently Asked Questions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="faq-questions"></a>
Frequently Asked Questions</h1>
<hr/>
<ul>
<li><a href="#faq-pack-array">Is it good practice to use a pack as an array?</a></li>
<li><a href="#faq-speed">Why is the speed-up of my code not as expected?</a></li>
<li><a href="#faq-memory-alignment">My code seg-faulted or crashed</a></li>
<li><a href="#faq-comparison">I tried to use a comparison operator and my code failed to compile</a></li>
<li><a href="#faq-speed-up">How do I measure the speed-up of my code</a></li>
<li><a href="#faq-sse-avx">My AVX code is not twice as fast as SSE</a></li>
<li><a href="#faq-code-gen">I disassembled my code, and the generated code is less than optimal.</a></li>
<li><a href="#faq-intrisic">How can I use a certain intrinsic?</a></li>
</ul>
<h2><a class="anchor" id="faq-pack-array"></a>
Is it good practice to use a pack as an array?</h2>
<hr/>
<p>The main element of Boost.SIMD is the <a class="el" href="classboost_1_1simd_1_1pack.html" title="High-level interface for manipulating SIMD data. ">boost::simd::pack</a> class. pack is an abstraction over a block of <code>N</code> elements of type <code>T</code>, quite similar to <code>std::array</code>. The main semantic difference is that <a class="el" href="classboost_1_1simd_1_1pack.html" title="High-level interface for manipulating SIMD data. ">boost::simd::pack</a> is implemented as the best hardware specific type able to store this amount of data which may be a simple scalar array, a single SIMD register or a tuple of SIMD registers depending on <code>N</code> and <code>T</code>.</p>
<p>In general, the good practice is to store data in regular, dynamic allocated data block and apply your algorithms over those data using pack and related functions.</p>
<h2><a class="anchor" id="faq-speed"></a>
Why is the speed-up of my code not as expected?</h2>
<hr/>
<p>There are several factors which can reduce the speed-up obtained using <b>Boost.SIMD</b>.</p><ul>
<li><p class="startli">Have you enabled compiler optimizations? You must enable all compiler optimizations as well as defining the <code>NDEBUG</code> flag</p>
<center> <table class="doxtable">
<tr>
<th>Compiler </th><th>Flag  </th></tr>
<tr>
<td>g++ </td><td>-O3 </td></tr>
<tr>
<td>clang++ </td><td>-O3 </td></tr>
<tr>
<td>Intel C++ Compiler </td><td>-O3 </td></tr>
<tr>
<td>Microsoft Visual Studio </td><td>Enable Release mode </td></tr>
</table>
</center></li>
<li>Have you compiled in 64bit mode? There is significant performance increase on architectures supporting 64 bit binaries.</li>
<li><p class="startli">Is you algorithm memory bound? Computational problems can often be classed as either compute-bound or memory-bound. Memory bound problems reach the limits of the system bandwidth transfering data between the memory and the processor, while compute-bound problems are limited by the processor's calculation ability.</p>
<p class="startli">Processors have often several hierarchies of caches. The time taken to transfer data from the cache to a register varies depending on the cache. When the required data is not in the cache, it is referred to as a cache miss. Cache-misses are very expensive. Data is transferred from memory to the cache in cache-lines sized chunks. On modern x86 machines, a cache-line is 64 bytes or twice the size of an AVX register. It is therefore highly advantageous to use all data loaded into cache.</p>
<p class="startli">The following loop is clearly memory bound as all of the time is spent loading and storing the data. The cost of the computation is negligible compared to that of the memory accesses.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i += pack_t::static_size) {</div><div class="line">    pack_t v0(&amp;data[i]);</div><div class="line">    v0 = v0 * 2;</div><div class="line">    <a class="code" href="namespaceboost_1_1simd.html#aaa551993873d3636d339e3ef32ffb56b">bs::aligned_store</a>(v0, &amp;output[i]);</div><div class="line">  }</div></div><!-- fragment --><p> The following loop is compute-bound. As most of the time is spent calculating exp, significant speed-up is observed when this code is vectorized.</p>
<div class="fragment"><div class="line">  t0 = high_resolution_clock::now();</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i += pack_t::static_size) {</div><div class="line">    pack_t v0(&amp;data[i]);</div><div class="line">    v0 = <a class="code" href="group__group-exponential_gaec8fcad0de6629150dcaf0c1e639afd8.html#gaec8fcad0de6629150dcaf0c1e639afd8">bs::exp</a>(<a class="code" href="group__group-exponential_gaec8fcad0de6629150dcaf0c1e639afd8.html#gaec8fcad0de6629150dcaf0c1e639afd8">bs::exp</a>(v0));</div><div class="line">    <a class="code" href="namespaceboost_1_1simd.html#aaa551993873d3636d339e3ef32ffb56b">bs::aligned_store</a>(v0, &amp;output[i]);</div><div class="line">  }</div></div><!-- fragment --></li>
<li>Is your code trivially vectorizable? Modern compilers can vectorize trivial code segments automatically. If you benchmark a trivial scalar code versus a vectorized code, the compiler may vectorize the scalar code, thereby giving similar performance to the vectorized version.</li>
<li>Is your algorithm vectorizable?</li>
<li>Have you used the fastest version of your function? Several <b>Boost.SIMD</b> functions, particularly more complex ones, come in several versions, where the user has a choice between accuracy and speed. This is achieved using decorators. Please refer to <a class="el" href="group__group-decorator.html">Decorators</a> for more information.</li>
</ul>
<h2><a class="anchor" id="faq-memory-alignment"></a>
Why did my code seg-faulted or crashed?</h2>
<hr/>
<p>The most common cause of seg-faults in SIMD codes is accessing non-aligned memory. For best performance, all memory should be aligned on pack_t::alignment bytes. Boost.SIMD includes an aligned memory allocator to help you with this. Please refer to <a class="el" href="tutorial-memory.html">Memory Alignment</a> for details on how to ensure that you memory is correctly aligned.</p>
<h2><a class="anchor" id="faq-comparison"></a>
I tried to use a comparison operator and my code failed to compile</h2>
<hr/>
<p>The most common reason for this is that the two packs being compared are not of the same type. Another common reason is that the return type is incorrect. Using auto is one way of preventing this error, however, it is best to be aware of the types you are using. Comparison operators in <b>Boost.SIMD</b> are of two types, either vectorized comparison, where the results is a vector of logical with the same cardinal as the input vectors, or a reduction comparison, where the result is a bool.</p>
<h2><a class="anchor" id="faq-speed-up"></a>
How to measure the speed-up of SIMD code?</h2>
<hr/>
<p>There are several ways to measure the speed-up of your code. You may use the <b>Boost.SIMD</b> bench system to benchmark your code segment. This allows you to measure the execution time of your code in cycles per element or in units of time.</p>
<p>Otherwise, you may use standard timing routines such as those available in <code>std::chrono</code>. In order to accurately benchmark your code, there are several points to consider.</p>
<ul>
<li>Your input should be sufficiently large. This is to eliminate cache effects.</li>
<li>Your code is compiled in release mode, with all optimizations enabled and debug information not included.</li>
<li>You should measure several times and use the average (or better the median).</li>
</ul>
<p>A typical case where a benchmark could give inaccurate results is where the input is not large enough to fill the cache and a scalar and SIMD code segment are individually benchmarked, one after the other. In this case, all of the data will be loaded into the cache during the first bench, and will be available for the second bench, therefore decreasing the execution time of the second bench. Also, if you measure the code segment multiple times, the data from the first execution will already be in the cache.</p>
<h2><a class="anchor" id="faq-sse-avx"></a>
My code compiled for AVX is not twice as fast as for SSE</h2>
<hr/>
<p>Not all SSE instructions have an equivalent AVX instruction. Also, the cycles required for certain instructions are not equal on both architectures, for example, sqrt on SSE requires 10-14 cycles whereas sqrt on AVX requires 21-28 cycles. Please refer <a href="http://www.agner.org/optimize/instruction_tables.pdf">here</a> for more information.</p>
<p>Very few integer operations are supported on AVX, AVX2 is required for most integer operations. If a <b>Boost.SIMD</b> function is called on an integer AVX register, this register will be split into two SSE registers and the equivalent instruction called on both register. In the case, no speed-up will be observed compared with SSE code. This is true also on Altivec, where double is not supported.</p>
<h2><a class="anchor" id="faq-code-gen"></a>
I disassembled my code, and the generated code is less than optimal.</h2>
<hr/>
<ul>
<li>Have you compiled in release mode, with full optimizations with DNDEBUG defined?</li>
<li>Have you used a 64 bit compiler?</li>
<li>There are many SIMD related bugs across all compilers, and some compilers generate less than optimal code in some cases. Is it possible to update your compiler to a more modern compiler?</li>
<li>We provide workarounds for all known compiler bugs, however, we may have missed some. You may also have found a bug in <b>Boost.SIMD</b>. Please report this through issues on our <a href="https://github.com/numscale/boost.simd/issues">github</a> with a minimal code example. We responds quickly to bug reports and do our best to patch them as quickly as possible.</li>
</ul>
<h2><a class="anchor" id="faq-intrisic"></a>
How can I use a certain intrinsic?</h2>
<hr/>
<p>If you require a certain intrinsic, you may search inside of <b>Boost.SIMD</b> for it and then call the relevant function.</p>
<p>In rare cases, the intrinsic may not be included in <b>Boost.SIMD</b> as we map the intrinsic wherever it makes sense semantically. If a certain intrinsic does not fit inside of this model, if may be excluded. In this case, you may call it yourself, however, this will not be portable. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr class="footer"/>
        <address class="footer">
            <small>
                Generated on Fri Jun 9 2017 10:01:40 for Boost.SIMD by &#160;
                <a href="http://www.doxygen.org/index.html">
                    <img class="footer" src="doxygen.png" alt="doxygen"/>
                </a>
                1.8.13
            </small>
        </address>
    </body>
</html>
